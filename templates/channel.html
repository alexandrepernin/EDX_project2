<!DOCTYPE html>
<html>
    <head>
        <title>Home</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <script>
          var channels = [];
          {% for channel in channels %}
            channels.push('{{channel}}');
          {% endfor %}
          document.addEventListener('DOMContentLoaded', () => {
                // 1 - Update welcome message with name stored in local storage
                let hello = 'Hello ';
                document.querySelector('#Name').innerHTML = hello.concat(localStorage.getItem('Name'));

                // 2 - Set the onsubmit property of the button: Ajax request to store server-side the new channel name
                document.querySelector('#form').onsubmit = () => {

                    // 2.1 - Initialize new request
                    const request = new XMLHttpRequest();
                    const channel_name = document.querySelector('#channel_entry').value;
                    request.open('POST', '/create-channel');

                    request.onload = () => {
                        location.reload();
                    }

                    // 2.2 - Add data to send with request: the name of the new channel
                    const data = new FormData();
                    data.append('channel_name', channel_name);

                    // 2.3 - Send request
                    request.send(data);
                    return false;
                  };


                  // 3 - Make sure the channel name is new
                  // 3.1 - By default, submit button is disabled
                  document.querySelector('#submit_button').disabled = true;
                  // 3.2 - On key up => verifies that contains at least one letter and that the channels is not already in the channel list
                  document.querySelector('#channel_entry').onkeyup = () => {
                    if (!(channels.includes(document.querySelector('#channel_entry').value)) && (/[a-zA-Z]/.test(document.querySelector('#channel_entry').value))) {
                      document.querySelector('#submit_button').disabled = false;
                    }
                    else {
                      document.querySelector('#submit_button').disabled = true;
                    }

                  };

           });
        </script>
     </head>
     <body>
         <div class="container-fluid">
           <div class="row">
                 <div class="col-4">
                 </div>
                 <div class="col-4">
                 <br>
                 <br>
                 <br>
                 <br>
                 <br>
                 <br>
                 <br>
                 <h1 id='Name'> </h1>
                 List of currently available channels:
                 <br>
                 <div class="list-group">
                   {% if channels %}
                      {% for channel in channels %}
                      <a href="{{ url_for('chat') }}" class="list-group-item list-group-item-action">Channel: {{channel}}</a>
                      {% endfor %}
                   {% else %}
                      <p>Sorry, no channel created yet</p>
                   {% endif %}
                 </div>


                </div>
                <div class="col-3">
                  <br>
                  <br>
                  <br>
                  <br>
                  <br>
                  <br>
                  <br>
                  <br>
                  <br>
                  <br>
                  Don't find what you're looking for? Create one:
                  <form id="form" method="post">
                    <div class="form-group">

                      <input id="channel_entry" type="text" class="form-control" aria-describedby="emailHelp" placeholder="Channel name" required>
                      <small id="subtext" class="form-text text-muted">This channel will be created just for you.</small>
                    </div>
                    <button id="submit_button" type="submit" class="btn btn-primary">Create channel</button>
                  </form>
                </div>

            </div>
        </div>
    </body>
</html>
